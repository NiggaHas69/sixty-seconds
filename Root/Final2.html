<!doctype html>
<html>

<style>
#gbox {
    position: absolute;
	top:100px;
    left:450px;
    border: 3px solid #73AD21;
	width: 50;
	height: 20;
}
</style>
  <head>
    <meta charset="UTF-8" />
    <title>Sixty Seconds</title>
	 <script src="player.js"> </script> 
  </head>


  <body>
  Collect resources one at a time and move to the bottom right
    <section>


      <div>
        <canvas id="canvas" width="1200" height=" 600">
          This text is displayed if your browser does not support HTML5 Canvas.
        </canvas>
      </div>
      <div id="gbox">
     
      <input type="text" id="txt" >
	  
      </div>


      <script type="text/javascript">
	  var buster = new Sprite("assets/img/Buster0.png");
	  var ini=0;
       var ctx = document.getElementById('canvas').getContext('2d');
        var dx = 6;
        var dy = 6;
        var x = 300;
        var y = 300;
        var players;
		 var xq= 60;
        var contX1 = 10;
        var contX2 = 405;
        var contY1 = 10;
        var contY2 = 405;
        var WIDTH = contX2 - contX1;
        var count;
        var HEIGHT = contY2 - contY1;
        var FLAG = 0;
        var collided=false;
        var resources =new Array();
        var vault =new Array();
        var c = 0;//for timer
        var t;//for timer
        var timer_is_on = 0;//for timer
        var resource_count = 0;
        var oxy =new Image();
        oxy.src ="assets/img/oxygen.jpg";
        var water=new Image();
        water.src ="assets/img/water.jpg";
        var l=490;
        for(var i=0;i<6;i++)
        {resources[i]= oxy ;
        resources[i].id='oxy';
          i++;
         resources[i] = water;
         resources[i].id='water';
        }
        var rx =new Array(); //array of x coordinates of resources
        rx.push(260);rx.push(220);rx.push(20);rx.push(90);rx.push(140);rx.push(280);
        var ry =new Array();
        ry.push(100);ry.push(240);ry.push(280);ry.push(360);ry.push(140);ry.push(240);
        var have =new Array();    //Created this
        resource_count=resources.length;
function inVault() {    
if (x>420 && x<495)
{
if(y>350 && y<375)
{return 1;}}
else return 0;
}

function keyInput(evt) {
if (ini==0)
{document.getElementById("txt").value = 0;
startCount();}
ini=1;
for(var i=0;i<rx.length;i++)
{
aBoxLeft=x-8;
aBoxRight=x+8;
aBoxTop=y-8;
aBoxBottom=y+5;

bBoxLeft=rx[i]-15;
bBoxRight=rx[i]+25;
bBoxTop=ry[i]-5;
bBoxBottom=ry[i]+28;

intersects( aBoxLeft,  aBoxRight,  aBoxTop,  aBoxBottom,
                           bBoxLeft,  bBoxRight,  bBoxTop,  bBoxBottom);
if(collided)
{
   remove(i);
   collided=false;
}
}
function remove(i){
     if (have.length==1)   //Player already has resource  
      return 0;
      have.push(resources[i].id);   
      resources.splice(i,1);
            rx.splice(i,1);
            ry.splice(i,1);
            resource_count --;

}


function intersects( aBoxLeft,  aBoxRight,  aBoxTop,  aBoxBottom,
                           bBoxLeft,  bBoxRight,  bBoxTop,  bBoxBottom) {

   if( bBoxRight >= aBoxLeft && bBoxBottom >= aBoxTop && aBoxRight >= bBoxLeft && aBoxBottom >= bBoxTop)
            collided = true;
}
       switch (evt.keyCode) {
      case 38:
  /* Up arrow was pressed */ {
    FLAG = 0; //Reset FLAG
    if (40 < x && x < 183 || x > 405 && x < 480) {
      if (y - 10 < 178 && y >= 178) {
        y = 183;
        FLAG = 1;
      }
      if (y - 10 < 208 && y >= 208) {
        y = 213;
        FLAG = 1;
      }

    }
    if (x > 480 && x < 500) {
      if (y - 10 < 320 && y >= 320) {
        y = 325;
        FLAG = 1;
      }
    }

    if (213 < x && x < 365) {
      if (y - 10 < 178 && y >= 178) {
        y = 183;
        FLAG = 1;
      }
      if (y - 10 < 208 && y >= 208) {
        y = 213;
        FLAG = 1;
      }
    }

    if (FLAG == 0 && y - dy > contY1 + 6) {
      y -= dy;
      buster.drawAnimated(x, y, [67, 68, 69, 71], ctx);
    }
  }
  break;

case 40:
  /* Down arrow was pressed */ {
    FLAG = 0; //Reset FLAG
    if (40 < x && x < 183 || x > 405 && x < 480) {
      if (y + 10 > 178 && y <= 178) {
        y = 173;
        FLAG = 1;
      }
      if (y + 10 > 208 && y <= 208) {
        y = 203;
        FLAG = 1;
      }

      if (y + 10 > 375 && y <= 375) {
        y = 370;
        FLAG = 1;
      }
    }
    if (x > 480 && x < 500) {
      if (y + 10 > 400 && y <= 400) {
        y = 395;
        FLAG = 1;
      }
    }
    if (213 < x && x <= 365) {
      if (y + 10 > 178 && y <= 178) {
        y = 173;
        FLAG = 1;
      }
      if (y + 10 > 208 && y <= 208) {
        y = 203;
        FLAG = 1;
      }
    }
    if (FLAG == 0 && y + 10 <= contY2) {
      y += dy;
      buster.drawAnimated(x, y, [79, 80, 81, 82, 83], ctx);
    }
  }
  break;

            case 37:
              /* Left arrow was pressed */
              {
                FLAG = 0; //Reset FLAG
                if (40 < y && y < 178 || y > 320 && y < 350  ) {
                  if (x - 10 < 183 && x >= 183) {
                    x = 188;
                    FLAG = 1;
                 
                  }
                  if (x - 10 < 213 && x >= 213) {
                    x = 218;
                    FLAG = 1;
                 
                  }
                  if(x-10 < 480 && x >= 480){
                    x= 485;
                    FLAG=1;
                  }
                }
                if (208 < y && y < 365) {
                  if (x - 10 < 213 && x >= 213) {
                    x = 218;
                    FLAG = 1;
                 
                  }
                  if (x - 10 < 183 && x >= 183) {
                    x = 188;
                    FLAG = 1;
                 
                  }
                }
                if (FLAG == 0 && x - dx > contX1 + 6) {
                  x -= dx;
				  buster.drawAnimated(x, y, [13,14,15,16,17,18],ctx);
                }
              }
              break;
            case 39:
              /* Right arrow was pressed */ {
			  
                FLAG = 0; //Reset FLAG
                if (40 < y && y < 178) {
                  if (x + 10 > 183 && x <= 183) {
                    x = 178; 
                    FLAG = 1;
                 
                  }
                  if (x + 10 > 213 && x <= 213) {
                    x = 208; 
                    FLAG = 1;
                 
                  }
                }

                if (208 < y && y < 365) {
                  if (x + 10 > 213 && x <= 213) {
                    x = 208; 
                    FLAG = 1;
                 
                  }
                  if (x + 10 > 183 && x <= 183) {
                    x = 178; 
                    FLAG = 1;
                 
                  }
                }
                if (FLAG == 0 && x + 1 <= WIDTH) {
                  x += dx;
				  buster.drawAnimated(x, y, [7,8,9,10,11,12],ctx); 
                }
				if(y<=375 && y>330 && x+5<470 && x>380)//for entering into vault
                { x +=dx; FLAG = 0 ;}
              else if (x+5 >= 470)
                FLAG =1; 
              }
             
          
              break;
          }// switch closes here
             
        }//function keyinput ends here
function timedCount() {
    document.getElementById("txt").value = c;
    c = c + 1;
    t = setTimeout(function(){ timedCount() }, 1000);
}

function startCount() {
    if (!timer_is_on  ) {
        timer_is_on = 1;
        timedCount();
		
    }
}

function stopCount() {
    clearTimeout(t);
    timer_is_on = 0;
}

        function init() {
          buster.drawAnimated(x, y, [13],ctx, 1);
         
          function player(x, y,r ) {
            ctx.clearRect(10, 10, 480, 400);
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2, true);
            ctx.fill();
			
            }
          function draw() {
		  
             //player (x,y,5);
            if (inVault() && have.length>=1)   //Player vault me hai and he has a resource
            {
            if (have[0]=='water')
            {ctx.drawImage(water,l,350,15,15);
            l+=20;
            have.splice(water,1);}         //Remove from have array
              if (have[0]=='oxy')
            {ctx.drawImage(oxy,l,350,15,15);
            l+=20;
            have.splice(oxy,1);}
            ctx.clearRect(405,350,25,75);
            }
        
            ctx.lineWidth = "6";
            ctx.beginPath();
            ctx.moveTo(10,10);
            ctx.lineTo(10,405);
            ctx.lineTo(405,405);
            ctx.lineTo(405,373);
            ctx.moveTo(405,352);
            ctx.lineTo(405,10);
            ctx.lineTo(8,10);
            ctx.stroke();
            ctx.beginPath(); //Path2Vault
            ctx.moveTo(405, 350);
            ctx.lineTo(480, 350);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(405, 375);
            ctx.lineTo(480, 375);
            ctx.closePath();
            ctx.stroke();
            ctx.lineWidth = "3";
            ctx.beginPath();
            ctx.moveTo(183, 40);
            ctx.lineTo(183, 178);
            ctx.lineTo(40, 178);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(213, 40);
            ctx.lineTo(213, 178);
            ctx.lineTo(365, 178);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(40, 208);
            ctx.lineTo(183, 208);
            ctx.lineTo(183, 365);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(213, 365);
            ctx.lineTo(213, 208);
            ctx.lineTo(365, 208);
            ctx.stroke();
           
            ctx.beginPath();
            ctx.moveTo(10, 193);
            ctx.lineTo(190, 193);
            //ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(207, 193);
            ctx.lineTo(405, 193);
            //ctx.stroke();
             
           
           
           ctx.lineWidth = "6";
           ctx.fillStyle='red';
            ctx.beginPath();
            ctx.moveTo(480,350);    //Drawing the vault
            ctx.lineTo(480,320);
            ctx.lineTo(630, 320);
            ctx.lineTo(630, 400);
            ctx.lineTo(480, 400);
            ctx.lineTo(480, 375);
            ctx.stroke();
          
         
            for (var i =0 ;i< resource_count;i++)
            ctx.drawImage(resources[i],rx[i],ry[i],30,30);
          
			if (inVault() && resource_count==0)
			{document.getElementById("txt").value = "Your score:"+c; 
			stopCount();}
       
            requestAnimationFrame(draw);
          }
		  
          draw();
		  document.getElementById("txt").value = 0;
          
     
      
     }    

        window.onload = init();
        window.addEventListener('keydown', keyInput, true);
      
      </script>
  </body>

</html>